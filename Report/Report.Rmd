---
title: "Análise de TcMax"
author: "Antonio e Fernando"
date: "14-07-2015"
output:
  html_document:
    theme: cosmo
    toc: yes
---

```{r bibliotecas, echo=FALSE, cache=TRUE, warning=FALSE, message=FALSE}
library(reshape2)
library(ggplot2)
library(lme4)
```

# Análise do banco de dados
Verificar quais as variáveis estão associadas com *TcMax*.

```{r carregando, cache=TRUE, echo=FALSE, warning=FALSE, message=FALSE}
dados <- read.csv("../tese.csv", header = TRUE, sep = ";", dec = ".")
levels(dados$localidade) <- c("Amazonia", "Caatinga", "Cerrado", "Mata Atlântica de Altitude", "Mata Atlântica")
estacoes <- read.csv("../temp_WS.csv", header = TRUE, sep = ";", dec = ".")[, -c(12, 13, 14)]
estacoes[, 'Bioma'] <- 'Não Definido'
estacoes[which(estacoes$WSlocality == 'Manaus'), 'Bioma'] <- 'Amazônia'
estacoes[which(estacoes$WSlocality == 'CamposdoJordao'), 'Bioma'] <- 'Mata Atântica de Altitude'
estacoes[which(estacoes$WSlocality == 'Guarulhos'), 'Bioma'] <- 'Mata Atântica'
estacoes[which(estacoes$WSlocality == 'S\xe3o Carlos'), 'Bioma'] <- 'Cerrado'
estacoes[which(estacoes$WSlocality == 'Florania'), 'Bioma'] <- 'Caatinga'

estacoes.Data <- aggregate(temperature ~ Bioma, data = estacoes, mean)
estacoes.Data <- data.frame(Bioma = estacoes.Data$Bioma,
                            Média = estacoes.Data$temperature,
                            Max = aggregate(temperature ~ Bioma, data = estacoes, max)[,2],
                            Min = aggregate(temperature ~ Bioma, data = estacoes, min)[,2])
estacoes.Data[, 'Amplitude'] <- estacoes.Data$Max - estacoes.Data$Min

```

## Análise descritiva

Abaixo estão os histogramas que apresentam a distribuição dos *tcmax* por bioma.

```{r ditr.bioma, cache=TRUE, echo=FALSE, warning=FALSE, message=FALSE, fig.height=6, fig.width=4, fig.cap=' Distribuição de tcMax'}
ggplot(dados, aes(x = tcmax)) + geom_histogram(binwidth = 0.5) +
  geom_histogram(colour = "white") +
  #geom_vline(x = mean(dados$tcmax), colour = 'blue') +
  facet_wrap( ~ localidade, scale = 'free_y', ncol = 1) + theme_bw()
```

Como a distribuição possui diferentes animais, estudamos a distruibuição dos *tcmax* por classe em diferentes biomas e verificamos que numa mesma classe a distribuição dos *tcmax* se ajustam aos biomas, como visto nas distribuições a seguir.

```{r ditr.Classe.bioma, cache=TRUE, echo=FALSE, warning=FALSE, message=FALSE, fig.height=10, fig.width=12, fig.cap= ' Distribuição de tcMax'}
ggplot(dados, aes(x = tcmax)) + geom_histogram(binwidth = 0.5) +
  geom_histogram(colour = "white") +
  xlab("Temperatura crítica máxima") + ylab("Número de indivíduos") +
#   geom_vline(x = mean(dados$tcmax), colour = 'blue') +
  facet_grid(localidade ~ classe, scale = 'free_y') + theme_bw() +
  theme(axis.text=element_text(face='plain'),
        axis.title=element_text(face="bold"),
        strip.text=element_text(size = 9, face="bold"))  
```

Das variáveis que descrevem os biomas, a *tempSOL* foi a que teve a melhor associação com a *tcmax*. A distribuição da *tempSOL* por classe em diferentes biomas está a seguir. 

```{r ditr.temSol.bioma, cache=TRUE, echo=FALSE, warning=FALSE, message=FALSE, fig.height=10, fig.width=12, fig.cap= ' Distribuição de TempSol'}
ggplot(dados, aes(x = tempSOL)) + geom_histogram(binwidth = 0.5) +
  geom_histogram(colour = "white") +
  xlab("Temperatura do solo (x cm de profundidade)") + ylab("Número de pontos de amostragem") +
#   geom_vline(x = mean(dados$tempSOL), colour = 'blue') +
  facet_grid(localidade ~ classe, scale = 'free') + theme_bw() +
  theme(axis.text=element_text(face='plain'),
        axis.title=element_text(face="bold"),
        strip.text=element_text(size = 9, face="bold"))  

```

## Modelo regressão (efeito misto) considerando os biomas

O primeiro modelo considerado é o modelo de efeitos mistos onde a 

```{r mixed.effect.Model, cache=TRUE, echo=FALSE}
# assume an intercept and slope that are different for each subject and they are
# correlated
#restricted maximum likelihood estimation REML
fit.mixed.2effects <- lmer(tcmax ~ 1 + tempSOL + (1 + tempSOL | localidade), data = dados, REML = F)
```

```{r mixed.effect.Summary, cache=TRUE, echo=TRUE}
summary(fit.mixed.2effects)
```

